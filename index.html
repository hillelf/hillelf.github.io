<!doctype html>
<html lang="en">
  <head>
    <base href="http://chegg-tutors.appspot.com/" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="/public/styles.css" />
    <style>
      #search_results {
        width: 100%;
        max-width: 450px;
        margin: auto;
        text-align: left;
      }
    </style>
  </head>
  <body>
    <div id="chg-balloon-logo-container">
        <img src="/public/img/logo.png" />
    </div>
    <div id="chg-balloon-controls-container">
        <p>Enter a username to get started!</p>
        <input id="chg-balloon-input" maxlength="2048" placeholder="e.g. BalloonMaster99"
            name="username" autocomplete="off" type="text" value="" />
        <button id="chg-balloon-submit">Check availability</button>
    </div>

    <div id="search_results"></div>

    <!--  jQuery template for username success message -->
    <script id="successTemplate" type="text/x-jQuery-tmpl">
      <div>Congrats! <strong>${username}</strong> is available!</div>
    </script>

    <!--  jQuery template for unsuccessful message  -->
    <script id="unsuccessTemplate" type="text/x-jQuery-tmpl">
      <div><strong>${username}</strong> is not available. How about one of these:</div>
    </script>

    <!--  jQuery template for username suggestions  -->
    <script id="suggestionsTemplate" type="text/x-jQuery-tmpl">
      <div><strong>${name}</strong></div>
    </script>

    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
    <script src="//ajax.aspnetcdn.com/ajax/jquery.templates/beta1/jquery.tmpl.js"></script>

    <script type="text/javascript">
      // we'll use '$' in the closure and leave it undefined globally
      jQuery.noConflict();

      (function ($) {
        // validate user input
        function validateInput(val) {
          if (!val) {
            return false;
          }
          return true;
        }

        // submit request with user input
        function submitRequest(uname) {
          var request = $.ajax({
            url: "/coding-challenge/api/user/",
            data: { username : uname }
          });

          request.done(function(data) {
            displayResult(data, uname);
            console.log(JSON.stringify(data));
          });

          request.fail(function(jqXHR, textStatus, errorThrown ) {
            console.log("Error: " + errorThrown);
          });
        }

        function displayResult(data, uname) {

          if (data.length > 0) { //username is taken
            var suggestions = [{name: "boo"}, {name: "danny"}, {name: "famjam"}];
            $("#search_results").html( $("#unsuccessTemplate").tmpl(data) );
            $("#suggestionsTemplate").tmpl(suggestions).appendTo("#search_results");
          } else { //username is available
            $("#search_results").html( $("#successTemplate").tmpl({username: uname}) );
          }

        }

        // register event handler for submit button
        $("#chg-balloon-submit").click(function(e) {

          var inputVal = $("#chg-balloon-input").val();
          var validInput = validateInput(inputVal);

          if (validInput) {
            submitRequest(inputVal);
          } else {
            console.log("invalid input");
          }
        });

      })(jQuery);

    </script>

  </body>
</html>
